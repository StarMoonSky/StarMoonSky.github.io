---
layout:     post
title:      玩玩Python爬虫
subtitle:   urllib2库
date:       2017-09-11
author:     CC
header-img: img/post-bg-ios10.jpg
catalog: true
tags:
    - Pyhon
    - HTTP
---


### urllib2 分分钟扒一个网页


import urllib2
 
response = urllib2.urlopen("http://www.baidu.com")
print response.read()

### 分析一下方法

首先我们调用的是urllib2库里面的urlopen方法，传入一个URL，这个网址是百度首页，协议是HTTP协议，当然你也可以把HTTP换做FTP,FILE,HTTPS 等等，只是代表了一种访问控制协议，urlopen一般接受三个参数，它的参数如下：

```swift
urlopen(url, data, timeout)
```
第一个参数url即为URL，第二个参数data是访问URL时要传送的数据，第三个timeout是设置超时时间。

第二三个参数是可以不传送的，data默认为空None，timeout默认为 socket._GLOBAL_DEFAULT_TIMEOUT

第一个参数URL是必须要传送的，在这个例子里面我们传送了百度的URL，执行urlopen方法之后，返回一个response对象，返回信息便保存在这里面。

### 字符串改动


#### String 操作简化了

`String` 许多要通过 `.characters` 进行的操作，可以直接用 String 进行操作了。

例如：

```swift
let greeting = "Hello, 😜!"
// No need to drill down to .characters
let n = greeting.count
let endOfSentence = greeting.index(of: "!")!

```

#### 构造Requset


其实上面的urlopen参数可以传入一个request请求,它其实就是一个Request类的实例，构造时需要传入Url,Data等等的内容。比如上面的两行代码，我们可以这么改写

```swift

import urllib2
 
request = urllib2.Request("http://www.baidu.com")
response = urllib2.urlopen(request)
print response.read()
```




#### POST和GET数据传送
我们引入了urllib库，现在我们模拟登陆，当然上述代码可能登陆不进去，因为还要做一些设置头部header的工作，或者还有一些参数 没有设置全，还没有提及到在此就不写上去了，在此只是说明登录的原理。我们需要定义一个字典，名字为values，参数我设置了username和 password，下面利用urllib的urlencode方法将字典编码，命名为data，构建request时传入两个参数，url和data，运 行程序，即可实现登陆，返回的便是登陆后呈现的页面内容。当然你可以自己搭建一个服务器来测试一下。
```swift
import urllib
import urllib2
 
values = {"username":"1016903103@qq.com","password":"XXXX"}
data = urllib.urlencode(values) 
url = "https://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn"
request = urllib2.Request(url,data)
response = urllib2.urlopen(request)
print response.read()
```


至于GET方式我们可以直接把参数写到网址上面，直接构建一个带参数的URL出来即可。
```swift
import urllib
import urllib2
 
values={}
values['username'] = "1016903103@qq.com"
values['password']="XXXX"
data = urllib.urlencode(values) 
url = "http://passport.csdn.net/account/login"
geturl = url + "?"+data
request = urllib2.Request(geturl)
response = urllib2.urlopen(request)
print response.read()
```

你可以print geturl，打印输出一下url，发现其实就是原来的url加？然后加编码后的参数
```swift
http://passport.csdn.net/account/login?username=1016903103%40qq.com&password=XXXX
```
